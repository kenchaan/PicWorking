/*******************************************************************************
*	Author		|	Date		|	FileName
*-------------------------------------------------------------------------------
*	kenchaan	|	2020/05/13	|	application.c
*-------------------------------------------------------------------------------
*	Description	|	アプリケーション処理
*-------------------------------------------------------------------------------
*	Copyright (c) 2020 kenchaan All Rights Reserved.
*******************************************************************************/

/*------------------------------------------------------------------------------
*	include
*-----------------------------------------------------------------------------*/
#include <xc.h>
#include "types.h"
#include "regaccess.h"
#include "hardware_port.h"
#include "hardware_timer.h"
#include "application.h"

/*------------------------------------------------------------------------------
*	pragma
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	define
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	macro
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	typedef
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	enum
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	struct
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static variable
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static function prototype
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	extern const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	function
*-----------------------------------------------------------------------------*/

/*------------------------------------------------------------------------------
* OverView	: アプリケーション初期化
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_Initialize( void )
{
	/* DO NOTHING */
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事前処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePreProcess( void )
{
	U32 count = HW_TIM_GetTimeCountSec();
	U08 h = (U08)(  (U32)count / 3600 );
	U08 m = (U08)(( (U32)count % 3600 ) / 60 );
	U08 s = (U08)(  (U32)count % 60 );

	/* スイッチ処理 */
	BOOL updated = FALSE;
	if( HW_PORT_IsActive( eINPUT_PORT_HOUR )){
		h++;
		if( h >= 24 ){
			h = 0;
		}
		updated = TRUE;
	}
	if( HW_PORT_IsActive( eINPUT_PORT_MINUTE )){
		m++;
		if( m >= 60 ){
			m = 0;
		}
		updated = TRUE;
	}
	if( HW_PORT_IsActive( eINPUT_PORT_SECOND_RST )){
		s = 0;
		updated = TRUE;
	}

	if( updated ){
		count = (U32)h * 3600 + (U32)m * 60 + (U32)s;
		HW_TIM_SetTimeCountSec( count );
	}
}

/*------------------------------------------------------------------------------
* OverView	: フレーム処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FrameMainProcess( void )
{
	/* 時間更新 */
	U32 count = HW_TIM_GetTimeCountSec();
	U08 h = (U08)(  (U32)count / 3600 );
	U08 m = (U08)(( (U32)count % 3600 ) / 60 );

	U08 digit[ 4 ];
	digit[ 0 ] = (U08)( h / 10 );
	digit[ 1 ] = (U08)( h % 10 );
	digit[ 2 ] = (U08)( m / 10 );
	digit[ 3 ] = (U08)( m % 10 );

	if( digit[ 0 ] == 0 ){
		digit[ 0 ] = 10;
	}

	HW_PORT_SetSegData( digit );
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事後処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePostProcess( void )
{
	/* DO NOTHING */
}


/*------------------------------------------------------------------------------
*	End Of File
*-----------------------------------------------------------------------------*/
