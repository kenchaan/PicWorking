/*******************************************************************************
*	Author		|	Date		|	FileName
*-------------------------------------------------------------------------------
*	ken_chaan	|	2018/12/25	|	application.c
*-------------------------------------------------------------------------------
*	Description	|	アプリケーション処理
*-------------------------------------------------------------------------------
*	Copyright (c) 2018 ken_chaan All Rights Reserved.
*******************************************************************************/

/*------------------------------------------------------------------------------
*	include
*-----------------------------------------------------------------------------*/
#include <xc.h>
#include "types.h"
#include "application.h"
#include "hardware_port.h"
#include "hardware_timer.h"
#include "hardware_ssp.h"

/*------------------------------------------------------------------------------
*	pragma
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	define
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	macro
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	typedef
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	enum
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	struct
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static variable
*-----------------------------------------------------------------------------*/
static U08 g_u08TimeCount_Ary[3] = { 0, 0, 0 };
static BOOL g_needSendTime = FALSE;

/*------------------------------------------------------------------------------
*	static function prototype
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	extern const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	function
*-----------------------------------------------------------------------------*/

/*------------------------------------------------------------------------------
* OverView	: アプリケーション初期化
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_Initialize( void )
{
	/* DO NOTHING */
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事前処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePreProcess( void )
{
	/* DO NOTHING */
}

/*------------------------------------------------------------------------------
* OverView	: フレーム処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FrameMainProcess( void )
{
	BOOL isUpdated = HW_TIM_IsUpdateTimer( eTIMER_TYPE_TIME );
	U32 count = HW_TIM_GetCount( eTIMER_TYPE_TIME );

	if( HW_PORT_Get( eINPUT_PORT_HOUR )){
		count += 3600;
		isUpdated = TRUE;
	}
	if( HW_PORT_Get( eINPUT_PORT_MINUTE )){
		count += 60;
		isUpdated = TRUE;
	}
	if( HW_PORT_Get( eINPUT_PORT_SEC_RESET )){
		count = (U32)( count / 60 ) * 60;
		isUpdated = TRUE;
	}
	count %= 86400;

	if( isUpdated ){
		HW_TIM_SetCount( eTIMER_TYPE_TIME, count );

		U08 time[ 3 ];
		time[ 0 ] = (U08)(( count % 86400 ) / 3600 );
		time[ 1 ] = (U08)(( count %  3600 ) /   60 );
		time[ 2 ] = (U08)(( count %    60 ) /    1 );

		HW_SSP_StoreSendData( SSP_DISPLAY_BUFFER, time, 3 );
		HW_SSP_StartSend( SSP_DISPLAY_BUFFER, SSP_DISPLAY_ADDR );
	}
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事後処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePostProcess( void )
{
	/* DO NOTHING */
}


/*------------------------------------------------------------------------------
*	End Of File
*-----------------------------------------------------------------------------*/
