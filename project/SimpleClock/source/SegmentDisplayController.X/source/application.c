/*******************************************************************************
*	Author		|	Date		|	FileName
*-------------------------------------------------------------------------------
*	ken_chaan	|	2019/01/07	|	application.c
*-------------------------------------------------------------------------------
*	Description	|	アプリケーション処理
*-------------------------------------------------------------------------------
*	Copyright (c) 2019 ken_chaan All Rights Reserved.
*******************************************************************************/

/*------------------------------------------------------------------------------
*	include
*-----------------------------------------------------------------------------*/
#include <xc.h>
#include "types.h"
#include "hardware_port.h"
#include "hardware_ssp.h"
#include "hardware.h"
#include "application.h"

/*------------------------------------------------------------------------------
*	pragma
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	define
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	macro
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	typedef
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	enum
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	struct
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static variable
*-----------------------------------------------------------------------------*/
static U08 g_u08DisplayData_Ary[ 3 ] = { 0, 0, 0 };
static E_OUTPUT_PORT_DIGIT g_eNextDigit = eOUTPUT_PORT_DIGIT_MIN;

/*------------------------------------------------------------------------------
*	static function prototype
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	static const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	extern const data
*-----------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
*	function
*-----------------------------------------------------------------------------*/

/*------------------------------------------------------------------------------
* OverView	: アプリケーション初期化
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_Initialize( void )
{
	/* DO NOTHING */
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事前処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePreProcess( void )
{
	/* DO NOTHING */
}

/*------------------------------------------------------------------------------
* OverView	: フレーム処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FrameMainProcess( void )
{
	/* すべて消灯 */
	HW_PORT_SetSegData( eOUTPUT_PORT_DIGIT_NONE, 10 );

	U08 segdata;
	switch( g_eNextDigit ){
	case eOUTPUT_PORT_DIGIT_H10:
		/* 表示データの確認 */
		if( HW_SSP_GetReceivedDataCount() >= 3 ){
			/* 最新3Byteのみ取得 */
			for( U08 i = 0; i < HW_SSP_GetReceivedDataCount() - 3; i++ ){
				/* 読み捨て */
				HW_SSP_GetReceivedData();
			}
			g_u08DisplayData_Ary[ 0 ] = HW_SSP_GetReceivedData();
			g_u08DisplayData_Ary[ 1 ] = HW_SSP_GetReceivedData();
			g_u08DisplayData_Ary[ 2 ] = HW_SSP_GetReceivedData();
		}

		segdata = (U08)( g_u08DisplayData_Ary[ 0 ] / 10 );
		if( segdata == 0 ){
			segdata = 10;
		}
		break;

	case eOUTPUT_PORT_DIGIT_H01:
		segdata = (U08)( g_u08DisplayData_Ary[ 0 ] % 10 );
		break;

	case eOUTPUT_PORT_DIGIT_M10:
		segdata = (U08)( g_u08DisplayData_Ary[ 1 ] / 10 );
		break;

	case eOUTPUT_PORT_DIGIT_M01:
		segdata = (U08)( g_u08DisplayData_Ary[ 1 ] % 10 );
		break;

	default:
		return;
	}

	/* ブランク期間 */
	__delay_us(300);

	/* 表示 */
	HW_PORT_SetSegData( g_eNextDigit, segdata );
	g_eNextDigit++;
	if( g_eNextDigit >= eOUTPUT_PORT_DIGIT_MAX ){
		g_eNextDigit = eOUTPUT_PORT_DIGIT_MIN;
	}
}

/*------------------------------------------------------------------------------
* OverView	: フレーム事後処理
* Parameter	: None
* Return	: None
*-----------------------------------------------------------------------------*/
void APP_FramePostProcess( void )
{
	/* DO NOTHING */
}


/*------------------------------------------------------------------------------
*	End Of File
*-----------------------------------------------------------------------------*/
